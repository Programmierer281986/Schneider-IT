// const list = [
//     {
//       "title": "einfachen Datentypen",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#einfache_Datentypen",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "Eigenschaften",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#einfache_Datentypen-Eigenschaften",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "Wertebereiche",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#einfache_Datentypen-Wertebereiche",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "Wertebereiche erklärt",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#einfache_Datentypen-Wertebereiche_erklärt",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "Operation mit Zahlen",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#einfache_Datentypen-Operation_mit_Zahlen",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "Int",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#einfache_Datentypen-Int",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "Double",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#einfache_Datentypen-Double",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "Float",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#einfache_Datentypen-Float",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "Bool",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#einfache_Datentypen-Bool",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "Struct",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#einfache_Datentypen-Struct",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "short",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#einfache_Datentypen-short",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "long",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#einfache_Datentypen-long",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "byte",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#einfache_Datentypen-byte",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "sbyte",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#einfache_Datentypen-sbyte",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "uint",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#einfache_Datentypen-uint",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "ushort",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#einfache_Datentypen-ushort",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "ulong",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#einfache_Datentypen-ulong",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "Eigenschaften",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#Referenztypen-Eigenschaften",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "Char",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#Referenztypen-Char",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "String",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#Referenztypen-String",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "Array",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#Referenztypen-Array",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "List",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#Referenztypen-List",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "Class",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#Referenztypen-Class",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "Enum",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#Referenztypen-Enum",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "Object",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#Referenztypen-Object",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "Delegate",
//       "location": "/docs/programmiersprachen/csharp/grundlagen/datentypen.html#Referenztypen-Delegate",
//       "ordner": "Programmiersprachen -> C# -> Grundlagen -> Datentypen",
//     },
//     {
//       "title": "Was ist das?",
//       "location": "/docs/programmiersprachen/brainfuck.html#Was_ist_das?",
//       "ordner": "Programmiersprachen -> Brainfuck",
//     },
//     {
//       "title": "Erklärung",
//       "location": "/docs/programmiersprachen/brainfuck.html#Erklärung",
//       "ordner": "Programmiersprachen -> Brainfuck",
//     },
//     {
//       "title": "Entwicklung",
//       "location": "/docs/programmiersprachen/brainfuck.html#Erklärung-Entwicklung",
//       "ordner": "Programmiersprachen -> Brainfuck",
//     },
//     {
//       "title": "Programmierung",
//       "location": "/docs/programmiersprachen/brainfuck.html#Erklärung-Programmierung",
//       "ordner": "Programmiersprachen -> Brainfuck",
//     },
//     {
//       "title": "Mit Brainfuck anfangen",
//       "location": "/docs/programmiersprachen/brainfuck.html#Erklärung-Mit_Brainfuck_anfangen",
//       "ordner": "Programmiersprachen -> Brainfuck",
//     }
// ]

const options = {
    isCaseSensitive: false,
    includeScore: true,
    shouldSort: true,
    includeMatches: false,
    findAllMatches: false,
    minMatchCharLength: 1,
    // location: 0,
    threshold: 0.3,
    // distance: 0,
    useExtendedSearch: true,
    ignoreLocation: true,
    ignoreFieldNorm: false,
    fieldNormWeight: 1,
    keys: [
      {
        name: 'title',
        weight: 0.9
      },
      {
        name: 'prettypath',
        weight: 0.1
      }
    ]
};

let fuse = null;
fetch('/tools/indexer/index.json').then(function (response) {
  // The API call was successful!
  return response.json()
}).then(function (data){
  fuse = new Fuse(data, options);
}).catch(function (err) {
  // There was an error
  alert('Error in loading json file.');
});

$("#search").on('keyup', function (e) {
  if((e.key !== "Tab" || e.keyCode !== 9) && (e.key !== "Shift" || e.keyCode !== 16) && (e.key !== "Enter" || e.keyCode !== 13)) {
    let search = document.getElementById('search_div');
    //search.scrollIntoViewIfNeeded(true);

    let pattern = document.getElementById('search').value;
    let ergebnisse = fuse.search(pattern);

    let container = document.getElementById('ergebnisse');
    container.innerHTML = ''; 

    console.log(JSON.stringify(ergebnisse,null,2));

    if(pattern != ""){
      document.querySelector('#search_div').setAttribute('data-after', 'Press Enter to open the first result!');
    }
    else {
      document.querySelector('#search_div').setAttribute('data-after', '');
    }


    for (let i = 0; i < ergebnisse.length; i++) {
      
      container.insertAdjacentHTML('beforeend', 
        '<div id="">' +
            '<a href=' + escapeHTML(ergebnisse[i].item.location) + '>' +
                '<h4>' + escapeHTML(ergebnisse[i].item.title) + '</h4>' +
                '<p>' + escapeHTML(ergebnisse[i].item.prettypath) + '</p>' +
            '</a>' +
        '</div>'
      );
    }
  }
});

document.onkeydown = function (e) {  
  if((e.key === "Tab" || e.keyCode === 9)){
    document.querySelector('#search_div').setAttribute('data-after', 'Press Enter to open the selected result!');

    let active_element = document.getElementById('active');
    if(active_element == null) {
      let container = document.getElementById('ergebnisse');
      let first_element = container.firstElementChild;
      if(first_element != null) {
        first_element.setAttribute('id', 'active');
      }
      return false;
    }
    let new_active_element;
    
    if(!e.shiftKey) {
      new_active_element = active_element.nextElementSibling;
    }
    else if(e.shiftKey) { 
      new_active_element = active_element.previousElementSibling;
    }

    if(new_active_element != null){ 
      active_element.setAttribute('id', '');
      new_active_element.setAttribute('id', 'active');
      new_active_element.scrollIntoViewIfNeeded(true);
    }
    else {
      active_element.setAttribute('id', '');
      let container = document.getElementById('ergebnisse');
      if(!e.shiftKey) {
        let first_element = container.firstElementChild;
        if(first_element != null) {
          first_element.setAttribute('id', 'active');
          first_element.scrollIntoViewIfNeeded(true);
        }
      }
      else if(e.shiftKey) { 
        let last_element = container.lastElementChild;
        if(last_element != null) {
          last_element.setAttribute('id', 'active');
          last_element.scrollIntoViewIfNeeded(true);
        }
      }
    }

    return false;
  }  

  if (e.key === 'Enter' || e.keyCode === 13) {
    let pattern = document.getElementById('search').value;
    let ergebnisse = fuse.search(pattern);
    let active_element = document.getElementById('active');
    if(active_element != null) {
      let link = active_element.firstElementChild.href;
      window.location.href = link;
    }
    else {
      window.location.href = ergebnisse[0].item.location;
    }
  }
}

$("#search_form").submit(function() {
    return false;
});

function escapeHTML(unescapedHTML) {
  return unescapedHTML.replace('<','&lt;').replace('>','&gt;').replace('<','&lt;').replace('>','&gt;');
}